{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _regeneratorRuntime = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _toConsumableArray = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _slicedToArray = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Logger = exports.ReferralFees = exports.OpenOrdersPda = void 0;\n\nvar anchor_1 = require(\"@project-serum/anchor\");\n\nvar web3_js_1 = require(\"@solana/web3.js\");\n\nvar OpenOrdersPda = /*#__PURE__*/function () {\n  function OpenOrdersPda(_ref) {\n    var proxyProgramId = _ref.proxyProgramId,\n        dexProgramId = _ref.dexProgramId;\n\n    _classCallCheck(this, OpenOrdersPda);\n\n    this._proxyProgramId = proxyProgramId;\n    this._dexProgramId = dexProgramId;\n  } // PDA authorized to create open orders accounts.\n\n\n  _createClass(OpenOrdersPda, [{\n    key: \"initOpenOrders\",\n    value: function initOpenOrders(ix) {\n      var market = ix.keys[2].pubkey;\n      var owner = ix.keys[1].pubkey; // b\"open-orders\"\n\n      var openOrdersSeed = Buffer.from([111, 112, 101, 110, 45, 111, 114, 100, 101, 114, 115]); // b\"open-orders-init\"\n\n      var openOrdersInitSeed = Buffer.from([111, 112, 101, 110, 45, 111, 114, 100, 101, 114, 115, 45, 105, 110, 105, 116]);\n\n      var _anchor_1$utils$publi = anchor_1.utils.publicKey.findProgramAddressSync([openOrdersSeed, this._dexProgramId.toBuffer(), market.toBuffer(), owner.toBuffer()], this._proxyProgramId),\n          _anchor_1$utils$publi2 = _slicedToArray(_anchor_1$utils$publi, 2),\n          openOrders = _anchor_1$utils$publi2[0],\n          bump = _anchor_1$utils$publi2[1];\n\n      var _anchor_1$utils$publi3 = anchor_1.utils.publicKey.findProgramAddressSync([openOrdersInitSeed, this._dexProgramId.toBuffer(), market.toBuffer()], this._proxyProgramId),\n          _anchor_1$utils$publi4 = _slicedToArray(_anchor_1$utils$publi3, 2),\n          marketAuthority = _anchor_1$utils$publi4[0],\n          bumpInit = _anchor_1$utils$publi4[1]; // Override the open orders account and market authority.\n\n\n      ix.keys[0].pubkey = openOrders;\n      ix.keys[4].pubkey = marketAuthority; // Writable because it must pay for the PDA initialization.\n\n      ix.keys[1].isWritable = true; // Prepend to the account list extra accounts needed for PDA initialization.\n\n      ix.keys = [{\n        pubkey: this._dexProgramId,\n        isSigner: false,\n        isWritable: false\n      }, {\n        pubkey: web3_js_1.SystemProgram.programId,\n        isSigner: false,\n        isWritable: false\n      }].concat(_toConsumableArray(ix.keys)); // Prepend the ix discriminator, bump, and bumpInit to the instruction data,\n      // which saves the program compute by avoiding recalculating them in the\n      // program.\n\n      ix.data = Buffer.concat([Buffer.from([0, bump, bumpInit]), ix.data]);\n    }\n  }, {\n    key: \"newOrderV3\",\n    value: function newOrderV3(ix) {\n      ix.data = Buffer.concat([Buffer.from([1]), ix.data]);\n    }\n  }, {\n    key: \"cancelOrderV2\",\n    value: function cancelOrderV2(ix) {\n      ix.data = Buffer.concat([Buffer.from([2]), ix.data]);\n    }\n  }, {\n    key: \"cancelOrderByClientIdV2\",\n    value: function cancelOrderByClientIdV2(ix) {\n      ix.data = Buffer.concat([Buffer.from([3]), ix.data]);\n    }\n  }, {\n    key: \"settleFunds\",\n    value: function settleFunds(ix) {\n      ix.data = Buffer.concat([Buffer.from([4]), ix.data]);\n    }\n  }, {\n    key: \"closeOpenOrders\",\n    value: function closeOpenOrders(ix) {\n      ix.data = Buffer.concat([Buffer.from([5]), ix.data]);\n    }\n  }, {\n    key: \"prune\",\n    value: function prune(ix) {\n      ix.data = Buffer.concat([Buffer.from([6]), ix.data]);\n    }\n  }], [{\n    key: \"marketAuthority\",\n    value: function () {\n      var _marketAuthority = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(market, dexProgramId, proxyProgramId) {\n        var openOrdersStr, _yield$web3_js_1$Publ, _yield$web3_js_1$Publ2, addr;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // b\"open-orders-init\"\n                openOrdersStr = Buffer.from([111, 112, 101, 110, 45, 111, 114, 100, 101, 114, 115, 45, 105, 110, 105, 116]);\n                _context.next = 3;\n                return web3_js_1.PublicKey.findProgramAddress([openOrdersStr, dexProgramId.toBuffer(), market.toBuffer()], proxyProgramId);\n\n              case 3:\n                _yield$web3_js_1$Publ = _context.sent;\n                _yield$web3_js_1$Publ2 = _slicedToArray(_yield$web3_js_1$Publ, 1);\n                addr = _yield$web3_js_1$Publ2[0];\n                return _context.abrupt(\"return\", addr);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function marketAuthority(_x, _x2, _x3) {\n        return _marketAuthority.apply(this, arguments);\n      }\n\n      return marketAuthority;\n    }()\n  }, {\n    key: \"openOrdersAddress\",\n    value: function () {\n      var _openOrdersAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(market, owner, dexProgramId, proxyProgramId) {\n        var openOrdersStr, _yield$web3_js_1$Publ3, _yield$web3_js_1$Publ4, addr;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // b\"open-orders\".\n                openOrdersStr = Buffer.from([111, 112, 101, 110, 45, 111, 114, 100, 101, 114, 115]);\n                _context2.next = 3;\n                return web3_js_1.PublicKey.findProgramAddress([openOrdersStr, dexProgramId.toBuffer(), market.toBuffer(), owner.toBuffer()], proxyProgramId);\n\n              case 3:\n                _yield$web3_js_1$Publ3 = _context2.sent;\n                _yield$web3_js_1$Publ4 = _slicedToArray(_yield$web3_js_1$Publ3, 1);\n                addr = _yield$web3_js_1$Publ4[0];\n                return _context2.abrupt(\"return\", addr);\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function openOrdersAddress(_x4, _x5, _x6, _x7) {\n        return _openOrdersAddress.apply(this, arguments);\n      }\n\n      return openOrdersAddress;\n    }()\n  }]);\n\n  return OpenOrdersPda;\n}();\n\nexports.OpenOrdersPda = OpenOrdersPda;\n\nvar ReferralFees = /*#__PURE__*/function () {\n  function ReferralFees() {\n    _classCallCheck(this, ReferralFees);\n  }\n\n  _createClass(ReferralFees, [{\n    key: \"initOpenOrders\",\n    value: // eslint-disable-next-line\n    function initOpenOrders(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"newOrderV3\",\n    value: function newOrderV3(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"cancelOrderV2\",\n    value: function cancelOrderV2(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"cancelOrderByClientIdV2\",\n    value: function cancelOrderByClientIdV2(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"settleFunds\",\n    value: function settleFunds(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"closeOpenOrders\",\n    value: function closeOpenOrders(_ix) {} // eslint-disable-next-line\n\n  }, {\n    key: \"prune\",\n    value: function prune(_ix) {}\n  }]);\n\n  return ReferralFees;\n}();\n\nexports.ReferralFees = ReferralFees;\n\nvar Logger = /*#__PURE__*/function () {\n  function Logger() {\n    _classCallCheck(this, Logger);\n  }\n\n  _createClass(Logger, [{\n    key: \"initOpenOrders\",\n    value: function initOpenOrders(ix) {\n      console.log('Proxying initOpenOrders', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"newOrderV3\",\n    value: function newOrderV3(ix) {\n      console.log('Proxying newOrderV3', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"cancelOrderV2\",\n    value: function cancelOrderV2(ix) {\n      console.log('Proxying cancelOrderV2', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"cancelOrderByClientIdV2\",\n    value: function cancelOrderByClientIdV2(ix) {\n      console.log('Proxying cancelOrderByClientIdV2', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"settleFunds\",\n    value: function settleFunds(ix) {\n      console.log('Proxying settleFunds', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"closeOpenOrders\",\n    value: function closeOpenOrders(ix) {\n      console.log('Proxying closeOpenOrders', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"prune\",\n    value: function prune(ix) {\n      console.log('Proxying prune', this.ixToDisplay(ix));\n    }\n  }, {\n    key: \"ixToDisplay\",\n    value: function ixToDisplay(ix) {\n      var keys = ix.keys.map(function (i) {\n        return _objectSpread(_objectSpread({}, i), {}, {\n          pubkey: i.pubkey.toString()\n        });\n      });\n      var programId = ix.programId.toString();\n      var data = new Uint8Array(ix.data);\n      return {\n        keys: keys,\n        programId: programId,\n        data: data\n      };\n    }\n  }]);\n\n  return Logger;\n}();\n\nexports.Logger = Logger;","map":{"version":3,"sources":["../../src/market-proxy/middleware.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = exports.ReferralFees = exports.OpenOrdersPda = void 0;\nconst anchor_1 = require(\"@project-serum/anchor\");\nconst web3_js_1 = require(\"@solana/web3.js\");\nclass OpenOrdersPda {\n    constructor({ proxyProgramId, dexProgramId, }) {\n        this._proxyProgramId = proxyProgramId;\n        this._dexProgramId = dexProgramId;\n    }\n    // PDA authorized to create open orders accounts.\n    static async marketAuthority(market, dexProgramId, proxyProgramId) {\n        // b\"open-orders-init\"\n        const openOrdersStr = Buffer.from([\n            111,\n            112,\n            101,\n            110,\n            45,\n            111,\n            114,\n            100,\n            101,\n            114,\n            115,\n            45,\n            105,\n            110,\n            105,\n            116,\n        ]);\n        const [addr] = await web3_js_1.PublicKey.findProgramAddress([openOrdersStr, dexProgramId.toBuffer(), market.toBuffer()], proxyProgramId);\n        return addr;\n    }\n    static async openOrdersAddress(market, owner, dexProgramId, proxyProgramId) {\n        // b\"open-orders\".\n        const openOrdersStr = Buffer.from([\n            111,\n            112,\n            101,\n            110,\n            45,\n            111,\n            114,\n            100,\n            101,\n            114,\n            115,\n        ]);\n        const [addr] = await web3_js_1.PublicKey.findProgramAddress([\n            openOrdersStr,\n            dexProgramId.toBuffer(),\n            market.toBuffer(),\n            owner.toBuffer(),\n        ], proxyProgramId);\n        return addr;\n    }\n    initOpenOrders(ix) {\n        const market = ix.keys[2].pubkey;\n        const owner = ix.keys[1].pubkey;\n        // b\"open-orders\"\n        const openOrdersSeed = Buffer.from([\n            111,\n            112,\n            101,\n            110,\n            45,\n            111,\n            114,\n            100,\n            101,\n            114,\n            115,\n        ]);\n        // b\"open-orders-init\"\n        const openOrdersInitSeed = Buffer.from([\n            111,\n            112,\n            101,\n            110,\n            45,\n            111,\n            114,\n            100,\n            101,\n            114,\n            115,\n            45,\n            105,\n            110,\n            105,\n            116,\n        ]);\n        const [openOrders, bump] = anchor_1.utils.publicKey.findProgramAddressSync([\n            openOrdersSeed,\n            this._dexProgramId.toBuffer(),\n            market.toBuffer(),\n            owner.toBuffer(),\n        ], this._proxyProgramId);\n        const [marketAuthority, bumpInit] = anchor_1.utils.publicKey.findProgramAddressSync([openOrdersInitSeed, this._dexProgramId.toBuffer(), market.toBuffer()], this._proxyProgramId);\n        // Override the open orders account and market authority.\n        ix.keys[0].pubkey = openOrders;\n        ix.keys[4].pubkey = marketAuthority;\n        // Writable because it must pay for the PDA initialization.\n        ix.keys[1].isWritable = true;\n        // Prepend to the account list extra accounts needed for PDA initialization.\n        ix.keys = [\n            { pubkey: this._dexProgramId, isSigner: false, isWritable: false },\n            { pubkey: web3_js_1.SystemProgram.programId, isSigner: false, isWritable: false },\n            ...ix.keys,\n        ];\n        // Prepend the ix discriminator, bump, and bumpInit to the instruction data,\n        // which saves the program compute by avoiding recalculating them in the\n        // program.\n        ix.data = Buffer.concat([Buffer.from([0, bump, bumpInit]), ix.data]);\n    }\n    newOrderV3(ix) {\n        ix.data = Buffer.concat([Buffer.from([1]), ix.data]);\n    }\n    cancelOrderV2(ix) {\n        ix.data = Buffer.concat([Buffer.from([2]), ix.data]);\n    }\n    cancelOrderByClientIdV2(ix) {\n        ix.data = Buffer.concat([Buffer.from([3]), ix.data]);\n    }\n    settleFunds(ix) {\n        ix.data = Buffer.concat([Buffer.from([4]), ix.data]);\n    }\n    closeOpenOrders(ix) {\n        ix.data = Buffer.concat([Buffer.from([5]), ix.data]);\n    }\n    prune(ix) {\n        ix.data = Buffer.concat([Buffer.from([6]), ix.data]);\n    }\n}\nexports.OpenOrdersPda = OpenOrdersPda;\nclass ReferralFees {\n    // eslint-disable-next-line\n    initOpenOrders(_ix) { }\n    // eslint-disable-next-line\n    newOrderV3(_ix) { }\n    // eslint-disable-next-line\n    cancelOrderV2(_ix) { }\n    // eslint-disable-next-line\n    cancelOrderByClientIdV2(_ix) { }\n    // eslint-disable-next-line\n    settleFunds(_ix) { }\n    // eslint-disable-next-line\n    closeOpenOrders(_ix) { }\n    // eslint-disable-next-line\n    prune(_ix) { }\n}\nexports.ReferralFees = ReferralFees;\nclass Logger {\n    initOpenOrders(ix) {\n        console.log('Proxying initOpenOrders', this.ixToDisplay(ix));\n    }\n    newOrderV3(ix) {\n        console.log('Proxying newOrderV3', this.ixToDisplay(ix));\n    }\n    cancelOrderV2(ix) {\n        console.log('Proxying cancelOrderV2', this.ixToDisplay(ix));\n    }\n    cancelOrderByClientIdV2(ix) {\n        console.log('Proxying cancelOrderByClientIdV2', this.ixToDisplay(ix));\n    }\n    settleFunds(ix) {\n        console.log('Proxying settleFunds', this.ixToDisplay(ix));\n    }\n    closeOpenOrders(ix) {\n        console.log('Proxying closeOpenOrders', this.ixToDisplay(ix));\n    }\n    prune(ix) {\n        console.log('Proxying prune', this.ixToDisplay(ix));\n    }\n    ixToDisplay(ix) {\n        const keys = ix.keys.map((i) => {\n            return { ...i, pubkey: i.pubkey.toString() };\n        });\n        const programId = ix.programId.toString();\n        const data = new Uint8Array(ix.data);\n        return { keys, programId, data };\n    }\n}\nexports.Logger = Logger;\n//# sourceMappingURL=middleware.js.map"]},"metadata":{},"sourceType":"script"}