{"ast":null,"code":"var _jsxFileName = \"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/src/components/Swap.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$(),\n    _s4 = $RefreshSig$(),\n    _s5 = $RefreshSig$(),\n    _s6 = $RefreshSig$(),\n    _s7 = $RefreshSig$(),\n    _s8 = $RefreshSig$(),\n    _s9 = $RefreshSig$();\n\nimport { useState } from \"react\";\nimport { Keypair, Transaction, SystemProgram } from \"@solana/web3.js\";\nimport { Token, TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\nimport { BN } from \"@project-serum/anchor\";\nimport { makeStyles, Card, Button, Typography, TextField, useTheme } from \"@material-ui/core\";\nimport { ExpandMore, ImportExportRounded } from \"@material-ui/icons\";\nimport { useSwapContext, useSwapFair } from \"../context/Swap\";\nimport { useDexContext, useOpenOrders, useRouteVerbose, useMarket, FEE_MULTIPLIER } from \"../context/Dex\";\nimport { useTokenMap } from \"../context/TokenList\";\nimport { useMint, useOwnedTokenAccount } from \"../context/Token\";\nimport { useCanSwap, useReferral } from \"../context/Swap\";\nimport { SettingsButton } from \"./Settings\";\nimport { InfoLabel } from \"./Info\";\nimport { SOL_MINT, WRAPPED_SOL_MINT } from \"../utils/pubkeys\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  card: {\n    width: theme.spacing(50),\n    borderRadius: theme.spacing(2),\n    boxShadow: \"0px 0px 30px 5px rgba(0,0,0,0.075)\",\n    padding: theme.spacing(2)\n  },\n  tab: {\n    width: \"50%\"\n  },\n  settingsButton: {\n    padding: 0\n  },\n  swapButton: {\n    width: \"100%\",\n    borderRadius: theme.spacing(2),\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    fontSize: 16,\n    fontWeight: 700,\n    padding: theme.spacing(1.5)\n  },\n  swapToFromButton: {\n    display: \"block\",\n    margin: \"10px auto 10px auto\",\n    cursor: \"pointer\"\n  },\n  amountInput: {\n    fontSize: 22,\n    fontWeight: 600\n  },\n  input: {\n    textAlign: \"right\"\n  },\n  swapTokenFormContainer: {\n    borderRadius: theme.spacing(2),\n    boxShadow: \"0px 0px 15px 2px rgba(33,150,243,0.1)\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    padding: theme.spacing(1)\n  },\n  swapTokenSelectorContainer: {\n    marginLeft: theme.spacing(1),\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"50%\"\n  },\n  balanceContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    fontSize: \"14px\"\n  },\n  maxButton: {\n    marginLeft: theme.spacing(1),\n    color: theme.palette.primary.main,\n    fontWeight: 700,\n    fontSize: \"12px\",\n    cursor: \"pointer\"\n  },\n  tokenButton: {\n    display: \"flex\",\n    alignItems: \"center\",\n    cursor: \"pointer\",\n    marginBottom: theme.spacing(1)\n  }\n}));\nexport default function SwapCard({\n  containerStyle,\n  contentStyle,\n  swapTokenContainerStyle\n}) {\n  _s();\n\n  const styles = useStyles();\n  return /*#__PURE__*/_jsxDEV(Card, {\n    className: styles.card,\n    style: containerStyle,\n    children: [/*#__PURE__*/_jsxDEV(SwapHeader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: contentStyle,\n      children: [/*#__PURE__*/_jsxDEV(SwapFromForm, {\n        style: swapTokenContainerStyle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ArrowButton, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SwapToForm, {\n        style: swapTokenContainerStyle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InfoLabel, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SwapButton, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SwapCard, \"3bjLmUB54uhXRX+frDMowQzU8P8=\", false, function () {\n  return [useStyles];\n});\n\n_c = SwapCard;\nexport function SwapHeader() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      marginBottom: \"16px\"\n    },\n    children: /*#__PURE__*/_jsxDEV(SettingsButton, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 129,\n    columnNumber: 5\n  }, this);\n}\n_c2 = SwapHeader;\nexport function ArrowButton() {\n  _s2();\n\n  const styles = useStyles();\n  const theme = useTheme();\n  const {\n    swapToFromMints\n  } = useSwapContext();\n  return /*#__PURE__*/_jsxDEV(ImportExportRounded, {\n    className: styles.swapToFromButton,\n    fontSize: \"large\",\n    htmlColor: theme.palette.primary.main,\n    onClick: swapToFromMints\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(ArrowButton, \"0YaKBGMT13tytLGPzdqTPV/oe9o=\", false, function () {\n  return [useStyles, useTheme, useSwapContext];\n});\n\n_c3 = ArrowButton;\n\nfunction SwapFromForm({\n  style\n}) {\n  _s3();\n\n  const {\n    fromMint,\n    setFromMint,\n    fromAmount,\n    setFromAmount\n  } = useSwapContext();\n  return /*#__PURE__*/_jsxDEV(SwapTokenForm, {\n    from: true,\n    style: style,\n    mint: fromMint,\n    setMint: setFromMint,\n    amount: fromAmount,\n    setAmount: setFromAmount\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n}\n\n_s3(SwapFromForm, \"0/IRyunKdisKxbn8nc7GjqZXJzk=\", false, function () {\n  return [useSwapContext];\n});\n\n_c4 = SwapFromForm;\n\nfunction SwapToForm({\n  style\n}) {\n  _s4();\n\n  const {\n    toMint,\n    setToMint,\n    toAmount,\n    setToAmount\n  } = useSwapContext();\n  return /*#__PURE__*/_jsxDEV(SwapTokenForm, {\n    from: false,\n    style: style,\n    mint: toMint,\n    setMint: setToMint,\n    amount: toAmount,\n    setAmount: setToAmount\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 172,\n    columnNumber: 5\n  }, this);\n}\n\n_s4(SwapToForm, \"R2mbzCYHrFe+N7n+2xgfN+VJDXc=\", false, function () {\n  return [useSwapContext];\n});\n\n_c5 = SwapToForm;\nexport function SwapTokenForm({\n  from,\n  style,\n  mint,\n  setMint,\n  amount,\n  setAmount\n}) {\n  _s5();\n\n  const styles = useStyles();\n  const [showTokenDialog, setShowTokenDialog] = useState(false);\n  const tokenAccount = useOwnedTokenAccount(mint);\n  const mintAccount = useMint(mint);\n  const balance = tokenAccount && mintAccount && tokenAccount.account.amount.toNumber() / 10 ** mintAccount.decimals;\n  const formattedAmount = mintAccount && amount ? amount.toLocaleString(\"fullwide\", {\n    maximumFractionDigits: mintAccount.decimals,\n    useGrouping: false\n  }) : amount;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.swapTokenFormContainer,\n    style: style,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.swapTokenSelectorContainer,\n      children: [/*#__PURE__*/_jsxDEV(TokenButton, {\n        mint: mint,\n        onClick: () => setShowTokenDialog(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        color: \"textSecondary\",\n        className: styles.balanceContainer,\n        children: [tokenAccount && mintAccount ? `Balance: ${balance === null || balance === void 0 ? void 0 : balance.toFixed(mintAccount.decimals)}` : `Balance : 0.00`, from && !!balance ? /*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.maxButton,\n          onClick: () => setAmount(balance),\n          children: \"MAX\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 13\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TextField, {\n      type: \"number\",\n      value: formattedAmount,\n      onChange: e => setAmount(parseFloat(e.target.value)),\n      InputProps: {\n        disableUnderline: true,\n        classes: {\n          root: styles.amountInput,\n          input: styles.input\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 218,\n    columnNumber: 5\n  }, this);\n}\n\n_s5(SwapTokenForm, \"4glAf9WncsuqoxnZo/07PnnQWPE=\", false, function () {\n  return [useStyles, useOwnedTokenAccount, useMint];\n});\n\n_c6 = SwapTokenForm;\n\nfunction TokenButton({\n  mint,\n  onClick\n}) {\n  _s6();\n\n  const styles = useStyles();\n  const theme = useTheme();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onClick: onClick,\n    className: styles.tokenButton,\n    children: [/*#__PURE__*/_jsxDEV(TokenIcon, {\n      mint: mint,\n      style: {\n        width: theme.spacing(4)\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TokenName, {\n      mint: mint,\n      style: {\n        fontSize: 14,\n        fontWeight: 700\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ExpandMore, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 263,\n    columnNumber: 5\n  }, this);\n}\n\n_s6(TokenButton, \"2Aj2+cIPQb6MyCs3+GXB/wqU108=\", false, function () {\n  return [useStyles, useTheme];\n});\n\n_c7 = TokenButton;\nexport function TokenIcon({\n  mint,\n  style\n}) {\n  _s7();\n\n  const tokenMap = useTokenMap();\n  let tokenInfo = tokenMap.get(mint.toString());\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      flexDirection: \"column\"\n    },\n    children: (tokenInfo === null || tokenInfo === void 0 ? void 0 : tokenInfo.logoURI) ? /*#__PURE__*/_jsxDEV(\"img\", {\n      alt: \"Logo\",\n      style: style,\n      src: tokenInfo === null || tokenInfo === void 0 ? void 0 : tokenInfo.logoURI\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 275,\n    columnNumber: 5\n  }, this);\n}\n\n_s7(TokenIcon, \"CseNJwJS9jgQSujNnEkXJYkyPrg=\", false, function () {\n  return [useTokenMap];\n});\n\n_c8 = TokenIcon;\n\nfunction TokenName({\n  mint,\n  style\n}) {\n  _s8();\n\n  const tokenMap = useTokenMap();\n  const theme = useTheme();\n  let tokenInfo = tokenMap.get(mint.toString());\n  return /*#__PURE__*/_jsxDEV(Typography, {\n    style: {\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1),\n      ...style\n    },\n    children: tokenInfo === null || tokenInfo === void 0 ? void 0 : tokenInfo.symbol\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 297,\n    columnNumber: 5\n  }, this);\n}\n\n_s8(TokenName, \"tPD7isZZ3fZjhx3ZY977BX01MZ4=\", false, function () {\n  return [useTokenMap, useTheme];\n});\n\n_c9 = TokenName;\nexport function SwapButton() {\n  _s9();\n\n  const styles = useStyles();\n  const {\n    fromMint,\n    toMint,\n    fromAmount,\n    slippage,\n    isClosingNewAccounts,\n    isStrict\n  } = useSwapContext();\n  const {\n    swapClient\n  } = useDexContext();\n  const fromMintInfo = useMint(fromMint);\n  const toMintInfo = useMint(toMint);\n  const openOrders = useOpenOrders();\n  const route = useRouteVerbose(fromMint, toMint);\n  const fromMarket = useMarket(route && route.markets ? route.markets[0] : undefined);\n  const toMarket = useMarket(route && route.markets ? route.markets[1] : undefined);\n  const canSwap = useCanSwap();\n  const referral = useReferral(fromMarket);\n  const fair = useSwapFair();\n  let fromWallet = useOwnedTokenAccount(fromMint);\n  let toWallet = useOwnedTokenAccount(toMint);\n  const quoteMint = fromMarket && fromMarket.quoteMintAddress;\n  const quoteMintInfo = useMint(quoteMint);\n  const quoteWallet = useOwnedTokenAccount(quoteMint); // Click handler.\n\n  const sendSwapTransaction = async () => {\n    if (!fromMintInfo || !toMintInfo) {\n      throw new Error(\"Unable to calculate mint decimals\");\n    }\n\n    if (!fair) {\n      throw new Error(\"Invalid fair\");\n    }\n\n    if (!quoteMint || !quoteMintInfo) {\n      throw new Error(\"Quote mint not found\");\n    }\n\n    const amount = new BN(fromAmount * 10 ** fromMintInfo.decimals);\n    const isSol = fromMint.equals(SOL_MINT) || toMint.equals(SOL_MINT);\n    const wrappedSolAccount = isSol ? Keypair.generate() : undefined; // Build the swap.\n\n    let txs = await (async () => {\n      if (!fromMarket) {\n        throw new Error(\"Market undefined\");\n      }\n\n      const minExchangeRate = {\n        rate: new BN(10 ** toMintInfo.decimals * FEE_MULTIPLIER / fair).muln(100 - slippage).divn(100),\n        fromDecimals: fromMintInfo.decimals,\n        quoteDecimals: quoteMintInfo.decimals,\n        strict: isStrict\n      };\n      const fromOpenOrders = fromMarket ? openOrders.get(fromMarket === null || fromMarket === void 0 ? void 0 : fromMarket.address.toString()) : undefined;\n      const toOpenOrders = toMarket ? openOrders.get(toMarket === null || toMarket === void 0 ? void 0 : toMarket.address.toString()) : undefined;\n      const fromWalletAddr = fromMint.equals(SOL_MINT) ? wrappedSolAccount.publicKey : fromWallet ? fromWallet.publicKey : undefined;\n      const toWalletAddr = toMint.equals(SOL_MINT) ? wrappedSolAccount.publicKey : toWallet ? toWallet.publicKey : undefined;\n      return await swapClient.swapTxs({\n        fromMint,\n        toMint,\n        quoteMint,\n        amount,\n        minExchangeRate,\n        referral,\n        fromMarket,\n        toMarket,\n        // Automatically created if undefined.\n        fromOpenOrders: fromOpenOrders ? fromOpenOrders[0].address : undefined,\n        toOpenOrders: toOpenOrders ? toOpenOrders[0].address : undefined,\n        fromWallet: fromWalletAddr,\n        toWallet: toWalletAddr,\n        quoteWallet: quoteWallet ? quoteWallet.publicKey : undefined,\n        // Auto close newly created open orders accounts.\n        close: isClosingNewAccounts\n      });\n    })(); // If swapping SOL, then insert a wrap/unwrap instruction.\n\n    if (isSol) {\n      if (txs.length > 1) {\n        throw new Error(\"SOL must be swapped in a single transaction\");\n      }\n\n      const {\n        tx: wrapTx,\n        signers: wrapSigners\n      } = await wrapSol(swapClient.program.provider, wrappedSolAccount, fromMint, amount);\n      const {\n        tx: unwrapTx,\n        signers: unwrapSigners\n      } = unwrapSol(swapClient.program.provider, wrappedSolAccount);\n      const tx = new Transaction();\n      tx.add(wrapTx);\n      tx.add(txs[0].tx);\n      tx.add(unwrapTx);\n      txs[0].tx = tx;\n      txs[0].signers.push(...wrapSigners);\n      txs[0].signers.push(...unwrapSigners);\n    }\n\n    await swapClient.program.provider.sendAll(txs);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Button, {\n    variant: \"contained\",\n    className: styles.swapButton,\n    onClick: sendSwapTransaction,\n    disabled: !canSwap,\n    children: \"Swap\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 433,\n    columnNumber: 5\n  }, this);\n}\n\n_s9(SwapButton, \"+PImLrYf2hCBe2NbyMcsGwbER/Y=\", false, function () {\n  return [useStyles, useSwapContext, useDexContext, useMint, useMint, useOpenOrders, useRouteVerbose, useMarket, useMarket, useCanSwap, useReferral, useSwapFair, useOwnedTokenAccount, useOwnedTokenAccount, useMint, useOwnedTokenAccount];\n});\n\n_c10 = SwapButton;\n\nasync function wrapSol(provider, wrappedSolAccount, fromMint, amount) {\n  const tx = new Transaction();\n  const signers = [wrappedSolAccount]; // Create new, rent exempt account.\n\n  tx.add(SystemProgram.createAccount({\n    fromPubkey: provider.wallet.publicKey,\n    newAccountPubkey: wrappedSolAccount.publicKey,\n    lamports: await Token.getMinBalanceRentForExemptAccount(provider.connection),\n    space: 165,\n    programId: TOKEN_PROGRAM_ID\n  })); // Transfer lamports. These will be converted to an SPL balance by the\n  // token program.\n\n  if (fromMint.equals(SOL_MINT)) {\n    tx.add(SystemProgram.transfer({\n      fromPubkey: provider.wallet.publicKey,\n      toPubkey: wrappedSolAccount.publicKey,\n      lamports: amount.toNumber()\n    }));\n  } // Initialize the account.\n\n\n  tx.add(Token.createInitAccountInstruction(TOKEN_PROGRAM_ID, WRAPPED_SOL_MINT, wrappedSolAccount.publicKey, provider.wallet.publicKey));\n  return {\n    tx,\n    signers\n  };\n}\n\nfunction unwrapSol(provider, wrappedSolAccount) {\n  const tx = new Transaction();\n  tx.add(Token.createCloseAccountInstruction(TOKEN_PROGRAM_ID, wrappedSolAccount.publicKey, provider.wallet.publicKey, provider.wallet.publicKey, []));\n  return {\n    tx,\n    signers: []\n  };\n}\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10;\n\n$RefreshReg$(_c, \"SwapCard\");\n$RefreshReg$(_c2, \"SwapHeader\");\n$RefreshReg$(_c3, \"ArrowButton\");\n$RefreshReg$(_c4, \"SwapFromForm\");\n$RefreshReg$(_c5, \"SwapToForm\");\n$RefreshReg$(_c6, \"SwapTokenForm\");\n$RefreshReg$(_c7, \"TokenButton\");\n$RefreshReg$(_c8, \"TokenIcon\");\n$RefreshReg$(_c9, \"TokenName\");\n$RefreshReg$(_c10, \"SwapButton\");","map":{"version":3,"sources":["/Users/selasie/Documents/GitHub/dex_ui/swap-ui/src/components/Swap.tsx"],"names":["useState","Keypair","Transaction","SystemProgram","Token","TOKEN_PROGRAM_ID","BN","makeStyles","Card","Button","Typography","TextField","useTheme","ExpandMore","ImportExportRounded","useSwapContext","useSwapFair","useDexContext","useOpenOrders","useRouteVerbose","useMarket","FEE_MULTIPLIER","useTokenMap","useMint","useOwnedTokenAccount","useCanSwap","useReferral","SettingsButton","InfoLabel","SOL_MINT","WRAPPED_SOL_MINT","useStyles","theme","card","width","spacing","borderRadius","boxShadow","padding","tab","settingsButton","swapButton","backgroundColor","palette","primary","main","color","contrastText","fontSize","fontWeight","swapToFromButton","display","margin","cursor","amountInput","input","textAlign","swapTokenFormContainer","justifyContent","swapTokenSelectorContainer","marginLeft","flexDirection","balanceContainer","alignItems","maxButton","tokenButton","marginBottom","SwapCard","containerStyle","contentStyle","swapTokenContainerStyle","styles","SwapHeader","ArrowButton","swapToFromMints","SwapFromForm","style","fromMint","setFromMint","fromAmount","setFromAmount","SwapToForm","toMint","setToMint","toAmount","setToAmount","SwapTokenForm","from","mint","setMint","amount","setAmount","showTokenDialog","setShowTokenDialog","tokenAccount","mintAccount","balance","account","toNumber","decimals","formattedAmount","toLocaleString","maximumFractionDigits","useGrouping","toFixed","e","parseFloat","target","value","disableUnderline","classes","root","TokenButton","onClick","TokenIcon","tokenMap","tokenInfo","get","toString","logoURI","TokenName","marginRight","symbol","SwapButton","slippage","isClosingNewAccounts","isStrict","swapClient","fromMintInfo","toMintInfo","openOrders","route","fromMarket","markets","undefined","toMarket","canSwap","referral","fair","fromWallet","toWallet","quoteMint","quoteMintAddress","quoteMintInfo","quoteWallet","sendSwapTransaction","Error","isSol","equals","wrappedSolAccount","generate","txs","minExchangeRate","rate","muln","divn","fromDecimals","quoteDecimals","strict","fromOpenOrders","address","toOpenOrders","fromWalletAddr","publicKey","toWalletAddr","swapTxs","close","length","tx","wrapTx","signers","wrapSigners","wrapSol","program","provider","unwrapTx","unwrapSigners","unwrapSol","add","push","sendAll","createAccount","fromPubkey","wallet","newAccountPubkey","lamports","getMinBalanceRentForExemptAccount","connection","space","programId","transfer","toPubkey","createInitAccountInstruction","createCloseAccountInstruction"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport {\n  PublicKey,\n  Keypair,\n  Transaction,\n  SystemProgram,\n  Signer,\n} from \"@solana/web3.js\";\nimport { Token, TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\nimport { BN, Provider } from \"@project-serum/anchor\";\nimport {\n  makeStyles,\n  Card,\n  Button,\n  Typography,\n  TextField,\n  useTheme,\n} from \"@material-ui/core\";\nimport { ExpandMore, ImportExportRounded } from \"@material-ui/icons\";\nimport { useSwapContext, useSwapFair } from \"../context/Swap\";\nimport {\n  useDexContext,\n  useOpenOrders,\n  useRouteVerbose,\n  useMarket,\n  FEE_MULTIPLIER,\n} from \"../context/Dex\";\nimport { useTokenMap } from \"../context/TokenList\";\nimport { useMint, useOwnedTokenAccount } from \"../context/Token\";\nimport { useCanSwap, useReferral } from \"../context/Swap\";\nimport TokenDialog from \"./TokenDialog\";\nimport { SettingsButton } from \"./Settings\";\nimport { InfoLabel } from \"./Info\";\nimport { SOL_MINT, WRAPPED_SOL_MINT } from \"../utils/pubkeys\";\n\nconst useStyles = makeStyles((theme) => ({\n  card: {\n    width: theme.spacing(50),\n    borderRadius: theme.spacing(2),\n    boxShadow: \"0px 0px 30px 5px rgba(0,0,0,0.075)\",\n    padding: theme.spacing(2),\n  },\n  tab: {\n    width: \"50%\",\n  },\n  settingsButton: {\n    padding: 0,\n  },\n  swapButton: {\n    width: \"100%\",\n    borderRadius: theme.spacing(2),\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    fontSize: 16,\n    fontWeight: 700,\n    padding: theme.spacing(1.5),\n  },\n  swapToFromButton: {\n    display: \"block\",\n    margin: \"10px auto 10px auto\",\n    cursor: \"pointer\",\n  },\n  amountInput: {\n    fontSize: 22,\n    fontWeight: 600,\n  },\n  input: {\n    textAlign: \"right\",\n  },\n  swapTokenFormContainer: {\n    borderRadius: theme.spacing(2),\n    boxShadow: \"0px 0px 15px 2px rgba(33,150,243,0.1)\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    padding: theme.spacing(1),\n  },\n  swapTokenSelectorContainer: {\n    marginLeft: theme.spacing(1),\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"50%\",\n  },\n  balanceContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    fontSize: \"14px\",\n  },\n  maxButton: {\n    marginLeft: theme.spacing(1),\n    color: theme.palette.primary.main,\n    fontWeight: 700,\n    fontSize: \"12px\",\n    cursor: \"pointer\",\n  },\n  tokenButton: {\n    display: \"flex\",\n    alignItems: \"center\",\n    cursor: \"pointer\",\n    marginBottom: theme.spacing(1),\n  },\n}));\n\nexport default function SwapCard({\n  containerStyle,\n  contentStyle,\n  swapTokenContainerStyle,\n}: {\n  containerStyle?: any;\n  contentStyle?: any;\n  swapTokenContainerStyle?: any;\n}) {\n  const styles = useStyles();\n  return (\n    <Card className={styles.card} style={containerStyle}>\n      <SwapHeader />\n      <div style={contentStyle}>\n        <SwapFromForm style={swapTokenContainerStyle} />\n        <ArrowButton />\n        <SwapToForm style={swapTokenContainerStyle} />\n        <InfoLabel />\n        <SwapButton />\n      </div>\n    </Card>\n  );\n}\n\nexport function SwapHeader() {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        marginBottom: \"16px\",\n      }}\n    >\n      <SettingsButton />\n    </div>\n  );\n}\n\nexport function ArrowButton() {\n  const styles = useStyles();\n  const theme = useTheme();\n  const { swapToFromMints } = useSwapContext();\n  return (\n    <ImportExportRounded\n      className={styles.swapToFromButton}\n      fontSize=\"large\"\n      htmlColor={theme.palette.primary.main}\n      onClick={swapToFromMints}\n    />\n  );\n}\n\nfunction SwapFromForm({ style }: { style?: any }) {\n  const { fromMint, setFromMint, fromAmount, setFromAmount } = useSwapContext();\n  return (\n    <SwapTokenForm\n      from\n      style={style}\n      mint={fromMint}\n      setMint={setFromMint}\n      amount={fromAmount}\n      setAmount={setFromAmount}\n    />\n  );\n}\n\nfunction SwapToForm({ style }: { style?: any }) {\n  const { toMint, setToMint, toAmount, setToAmount } = useSwapContext();\n  return (\n    <SwapTokenForm\n      from={false}\n      style={style}\n      mint={toMint}\n      setMint={setToMint}\n      amount={toAmount}\n      setAmount={setToAmount}\n    />\n  );\n}\n\nexport function SwapTokenForm({\n  from,\n  style,\n  mint,\n  setMint,\n  amount,\n  setAmount,\n}: {\n  from: boolean;\n  style?: any;\n  mint: PublicKey;\n  setMint: (m: PublicKey) => void;\n  amount: number;\n  setAmount: (a: number) => void;\n}) {\n  const styles = useStyles();\n\n  const [showTokenDialog, setShowTokenDialog] = useState(false);\n  const tokenAccount = useOwnedTokenAccount(mint);\n  const mintAccount = useMint(mint);\n\n  const balance =\n    tokenAccount &&\n    mintAccount &&\n    tokenAccount.account.amount.toNumber() / 10 ** mintAccount.decimals;\n\n  const formattedAmount =\n    mintAccount && amount\n      ? amount.toLocaleString(\"fullwide\", {\n          maximumFractionDigits: mintAccount.decimals,\n          useGrouping: false,\n        })\n      : amount;\n\n  return (\n    <div className={styles.swapTokenFormContainer} style={style}>\n      <div className={styles.swapTokenSelectorContainer}>\n        <TokenButton mint={mint} onClick={() => setShowTokenDialog(true)} />\n        <Typography color=\"textSecondary\" className={styles.balanceContainer}>\n          {tokenAccount && mintAccount\n            ? `Balance: ${balance?.toFixed(mintAccount.decimals)}`\n            : `Balance : 0.00`}\n          {from && !!balance ? (\n            <span\n              className={styles.maxButton}\n              onClick={() => setAmount(balance)}\n            >\n              MAX\n            </span>\n          ) : null}\n        </Typography>\n      </div>\n      <TextField\n        type=\"number\"\n        value={formattedAmount}\n        onChange={(e) => setAmount(parseFloat(e.target.value))}\n        InputProps={{\n          disableUnderline: true,\n          classes: {\n            root: styles.amountInput,\n            input: styles.input,\n          },\n        }}\n      />\n\n    </div>\n  );\n}\n\nfunction TokenButton({\n  mint,\n  onClick,\n}: {\n  mint: PublicKey;\n  onClick: () => void;\n}) {\n  const styles = useStyles();\n  const theme = useTheme();\n\n  return (\n    <div onClick={onClick} className={styles.tokenButton}>\n      <TokenIcon mint={mint} style={{ width: theme.spacing(4) }} />\n      <TokenName mint={mint} style={{ fontSize: 14, fontWeight: 700 }} />\n      <ExpandMore />\n    </div>\n  );\n}\n\nexport function TokenIcon({ mint, style }: { mint: PublicKey; style: any }) {\n  const tokenMap = useTokenMap();\n  let tokenInfo = tokenMap.get(mint.toString());\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        flexDirection: \"column\",\n      }}\n    >\n      {tokenInfo?.logoURI ? (\n        <img alt=\"Logo\" style={style} src={tokenInfo?.logoURI} />\n      ) : (\n        <div style={style}></div>\n      )}\n    </div>\n  );\n}\n\nfunction TokenName({ mint, style }: { mint: PublicKey; style: any }) {\n  const tokenMap = useTokenMap();\n  const theme = useTheme();\n  let tokenInfo = tokenMap.get(mint.toString());\n\n  return (\n    <Typography\n      style={{\n        marginLeft: theme.spacing(2),\n        marginRight: theme.spacing(1),\n        ...style,\n      }}\n    >\n      {tokenInfo?.symbol}\n    </Typography>\n  );\n}\n\nexport function SwapButton() {\n  const styles = useStyles();\n  const {\n    fromMint,\n    toMint,\n    fromAmount,\n    slippage,\n    isClosingNewAccounts,\n    isStrict,\n  } = useSwapContext();\n  const { swapClient } = useDexContext();\n  const fromMintInfo = useMint(fromMint);\n  const toMintInfo = useMint(toMint);\n  const openOrders = useOpenOrders();\n  const route = useRouteVerbose(fromMint, toMint);\n  const fromMarket = useMarket(\n    route && route.markets ? route.markets[0] : undefined\n  );\n  const toMarket = useMarket(\n    route && route.markets ? route.markets[1] : undefined\n  );\n  const canSwap = useCanSwap();\n  const referral = useReferral(fromMarket);\n  const fair = useSwapFair();\n  let fromWallet = useOwnedTokenAccount(fromMint);\n  let toWallet = useOwnedTokenAccount(toMint);\n  const quoteMint = fromMarket && fromMarket.quoteMintAddress;\n  const quoteMintInfo = useMint(quoteMint);\n  const quoteWallet = useOwnedTokenAccount(quoteMint);\n\n  // Click handler.\n  const sendSwapTransaction = async () => {\n    if (!fromMintInfo || !toMintInfo) {\n      throw new Error(\"Unable to calculate mint decimals\");\n    }\n    if (!fair) {\n      throw new Error(\"Invalid fair\");\n    }\n    if (!quoteMint || !quoteMintInfo) {\n      throw new Error(\"Quote mint not found\");\n    }\n\n    const amount = new BN(fromAmount * 10 ** fromMintInfo.decimals);\n    const isSol = fromMint.equals(SOL_MINT) || toMint.equals(SOL_MINT);\n    const wrappedSolAccount = isSol ? Keypair.generate() : undefined;\n\n    // Build the swap.\n    let txs = await (async () => {\n      if (!fromMarket) {\n        throw new Error(\"Market undefined\");\n      }\n\n      const minExchangeRate = {\n        rate: new BN((10 ** toMintInfo.decimals * FEE_MULTIPLIER) / fair)\n          .muln(100 - slippage)\n          .divn(100),\n        fromDecimals: fromMintInfo.decimals,\n        quoteDecimals: quoteMintInfo.decimals,\n        strict: isStrict,\n      };\n      const fromOpenOrders = fromMarket\n        ? openOrders.get(fromMarket?.address.toString())\n        : undefined;\n      const toOpenOrders = toMarket\n        ? openOrders.get(toMarket?.address.toString())\n        : undefined;\n      const fromWalletAddr = fromMint.equals(SOL_MINT)\n        ? wrappedSolAccount!.publicKey\n        : fromWallet\n        ? fromWallet.publicKey\n        : undefined;\n      const toWalletAddr = toMint.equals(SOL_MINT)\n        ? wrappedSolAccount!.publicKey\n        : toWallet\n        ? toWallet.publicKey\n        : undefined;\n\n      return await swapClient.swapTxs({\n        fromMint,\n        toMint,\n        quoteMint,\n        amount,\n        minExchangeRate,\n        referral,\n        fromMarket,\n        toMarket,\n        // Automatically created if undefined.\n        fromOpenOrders: fromOpenOrders ? fromOpenOrders[0].address : undefined,\n        toOpenOrders: toOpenOrders ? toOpenOrders[0].address : undefined,\n        fromWallet: fromWalletAddr,\n        toWallet: toWalletAddr,\n        quoteWallet: quoteWallet ? quoteWallet.publicKey : undefined,\n        // Auto close newly created open orders accounts.\n        close: isClosingNewAccounts,\n      });\n    })();\n\n    // If swapping SOL, then insert a wrap/unwrap instruction.\n    if (isSol) {\n      if (txs.length > 1) {\n        throw new Error(\"SOL must be swapped in a single transaction\");\n      }\n      const { tx: wrapTx, signers: wrapSigners } = await wrapSol(\n        swapClient.program.provider,\n        wrappedSolAccount as Keypair,\n        fromMint,\n        amount\n      );\n      const { tx: unwrapTx, signers: unwrapSigners } = unwrapSol(\n        swapClient.program.provider,\n        wrappedSolAccount as Keypair\n      );\n      const tx = new Transaction();\n      tx.add(wrapTx);\n      tx.add(txs[0].tx);\n      tx.add(unwrapTx);\n      txs[0].tx = tx;\n      txs[0].signers.push(...wrapSigners);\n      txs[0].signers.push(...unwrapSigners);\n    }\n\n    await swapClient.program.provider.sendAll(txs);\n  };\n  return (\n    <Button\n      variant=\"contained\"\n      className={styles.swapButton}\n      onClick={sendSwapTransaction}\n      disabled={!canSwap}\n    >\n      Swap\n    </Button>\n  );\n}\n\nasync function wrapSol(\n  provider: Provider,\n  wrappedSolAccount: Keypair,\n  fromMint: PublicKey,\n  amount: BN\n): Promise<{ tx: Transaction; signers: Array<Signer | undefined> }> {\n  const tx = new Transaction();\n  const signers = [wrappedSolAccount];\n  // Create new, rent exempt account.\n  tx.add(\n    SystemProgram.createAccount({\n      fromPubkey: provider.wallet.publicKey,\n      newAccountPubkey: wrappedSolAccount.publicKey,\n      lamports: await Token.getMinBalanceRentForExemptAccount(\n        provider.connection\n      ),\n      space: 165,\n      programId: TOKEN_PROGRAM_ID,\n    })\n  );\n  // Transfer lamports. These will be converted to an SPL balance by the\n  // token program.\n  if (fromMint.equals(SOL_MINT)) {\n    tx.add(\n      SystemProgram.transfer({\n        fromPubkey: provider.wallet.publicKey,\n        toPubkey: wrappedSolAccount.publicKey,\n        lamports: amount.toNumber(),\n      })\n    );\n  }\n  // Initialize the account.\n  tx.add(\n    Token.createInitAccountInstruction(\n      TOKEN_PROGRAM_ID,\n      WRAPPED_SOL_MINT,\n      wrappedSolAccount.publicKey,\n      provider.wallet.publicKey\n    )\n  );\n  return { tx, signers };\n}\n\nfunction unwrapSol(\n  provider: Provider,\n  wrappedSolAccount: Keypair\n): { tx: Transaction; signers: Array<Signer | undefined> } {\n  const tx = new Transaction();\n  tx.add(\n    Token.createCloseAccountInstruction(\n      TOKEN_PROGRAM_ID,\n      wrappedSolAccount.publicKey,\n      provider.wallet.publicKey,\n      provider.wallet.publicKey,\n      []\n    )\n  );\n  return { tx, signers: [] };\n}\n"]},"metadata":{},"sourceType":"module"}