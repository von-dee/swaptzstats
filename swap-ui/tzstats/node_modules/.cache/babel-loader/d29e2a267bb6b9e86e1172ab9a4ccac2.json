{"ast":null,"code":"import _toConsumableArray from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState}from\"react\";import{Keypair,Transaction,SystemProgram}from\"@solana/web3.js\";import{Token,TOKEN_PROGRAM_ID}from\"@solana/spl-token\";import{BN}from\"@project-serum/anchor\";import{makeStyles,Card,Button,Typography,TextField,useTheme}from\"@material-ui/core\";import{ImportExportRounded}from\"@material-ui/icons\";import{useSwapContext,useSwapFair}from\"../context/Swap\";import{useDexContext,useOpenOrders,useRouteVerbose,useMarket,FEE_MULTIPLIER}from\"../context/Dex\";import{useTokenMap}from\"../context/TokenList\";import{useMint,useOwnedTokenAccount}from\"../context/Token\";import{useCanSwap,useReferral}from\"../context/Swap\";import TokenDialog from\"./TokenDialog\";import{SettingsButton}from\"./Settings\";import{InfoLabel}from\"./Info\";import{SOL_MINT,WRAPPED_SOL_MINT}from\"../utils/pubkeys\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{card:{width:theme.spacing(50),borderRadius:theme.spacing(2),background:\"#22242a\",border:\"1px solid #aaaaaa36\",color:\"white !important\",boxShadow:\"0px 0px 30px 5px rgba(0,0,0,0.075)\",padding:theme.spacing(2)},tab:{width:\"50%\"},settingsButton:{padding:0},swapButton:{width:\"100%\",textTransform:\"capitalize\",borderRadius:theme.spacing(2),backgroundColor:\"#323741\",color:\"white !important\",fontSize:16,fontWeight:700,padding:theme.spacing(1.5)},swapToFromButton:{display:\"block\",margin:\"5px auto 5px auto\",cursor:\"pointer\"},amountInput:{fontSize:22,fontWeight:600,color:\"white !important\"},input:{textAlign:\"left\",color:\"white !important\"},swapTokenFormContainer:{borderRadius:theme.spacing(2),boxShadow:\"0px 0px 15px 2px rgba(33,150,243,0.1)\",display:\"flex\",justifyContent:\"space-between\",background:\"#323741\",padding:\"5px 10px 5px 15px\",border:\"1px solid #ffffff1c\"},swapTokenSelectorContainer:{marginLeft:theme.spacing(1),display:\"flex\",justifyContent:\"flex-end\",flexDirection:\"column\",width:\"30%\"},balanceContainer:{display:\"flex\",alignItems:\"center\",padding:\"2px 0px\",fontSize:\"12px\",color:\"#bebebe\"},maxButton:{marginLeft:theme.spacing(1),color:theme.palette.primary.main,fontWeight:700,fontSize:\"12px\",cursor:\"pointer\"},tokenButton:{display:\"flex\",alignItems:\"center\",cursor:\"pointer\",marginBottom:theme.spacing(1),border:\"1px solid #585858\",borderRadius:\"20px\",background:\"#161616\"}};});export default function SwapCard(_ref){var containerStyle=_ref.containerStyle,contentStyle=_ref.contentStyle,swapTokenContainerStyle=_ref.swapTokenContainerStyle;var styles=useStyles();return/*#__PURE__*/_jsx(Card,{className:styles.card,style:containerStyle,children:/*#__PURE__*/_jsxs(\"div\",{style:contentStyle,children:[/*#__PURE__*/_jsx(SwapFromForm,{style:swapTokenContainerStyle}),/*#__PURE__*/_jsx(ArrowButton,{}),/*#__PURE__*/_jsx(SwapToForm,{style:swapTokenContainerStyle}),/*#__PURE__*/_jsx(InfoLabel,{}),/*#__PURE__*/_jsx(SwapButton,{})]})});}export function SwapHeader(){return/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",marginBottom:\"16px\"},children:/*#__PURE__*/_jsx(SettingsButton,{})});}export function ArrowButton(){var styles=useStyles();var theme=useTheme();var _useSwapContext=useSwapContext(),swapToFromMints=_useSwapContext.swapToFromMints;return/*#__PURE__*/_jsx(ImportExportRounded,{className:styles.swapToFromButton,fontSize:\"medium\",htmlColor:theme.palette.primary.main,onClick:swapToFromMints});}function SwapFromForm(_ref2){var style=_ref2.style;var _useSwapContext2=useSwapContext(),fromMint=_useSwapContext2.fromMint,setFromMint=_useSwapContext2.setFromMint,fromAmount=_useSwapContext2.fromAmount,setFromAmount=_useSwapContext2.setFromAmount;return/*#__PURE__*/_jsx(SwapTokenForm,{from:true,style:style,mint:fromMint,setMint:setFromMint,amount:fromAmount,setAmount:setFromAmount});}function SwapToForm(_ref3){var style=_ref3.style;var _useSwapContext3=useSwapContext(),toMint=_useSwapContext3.toMint,setToMint=_useSwapContext3.setToMint,toAmount=_useSwapContext3.toAmount,setToAmount=_useSwapContext3.setToAmount;return/*#__PURE__*/_jsx(SwapTokenForm,{from:false,style:style,mint:toMint,setMint:setToMint,amount:toAmount,setAmount:setToAmount});}export function SwapTokenForm(_ref4){var from=_ref4.from,style=_ref4.style,mint=_ref4.mint,setMint=_ref4.setMint,amount=_ref4.amount,setAmount=_ref4.setAmount;var styles=useStyles();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showTokenDialog=_useState2[0],setShowTokenDialog=_useState2[1];var tokenAccount=useOwnedTokenAccount(mint);var mintAccount=useMint(mint);var balance=tokenAccount&&mintAccount&&tokenAccount.account.amount.toNumber()/Math.pow(10,mintAccount.decimals);var formattedAmount=mintAccount&&amount?amount.toLocaleString(\"fullwide\",{maximumFractionDigits:mintAccount.decimals,useGrouping:false}):amount;return/*#__PURE__*/_jsxs(\"div\",{className:styles.swapTokenFormContainer,style:style,children:[/*#__PURE__*/_jsx(TokenDialog,{setMint:setMint,open:showTokenDialog,onClose:function onClose(){return setShowTokenDialog(false);}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Typography,{className:styles.balanceContainer,children:from?\"From\":\"To\"}),/*#__PURE__*/_jsx(TextField,{type:\"number\",value:formattedAmount,onChange:function onChange(e){return setAmount(parseFloat(e.target.value));},InputProps:{disableUnderline:true,classes:{root:styles.amountInput,input:styles.input}}})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.swapTokenSelectorContainer,children:[/*#__PURE__*/_jsxs(Typography,{className:styles.balanceContainer,children:[tokenAccount&&mintAccount?\"Balance: \".concat(balance===null||balance===void 0?void 0:balance.toFixed(mintAccount.decimals)):\"Balance : 0.00\",from&&!!balance?/*#__PURE__*/_jsx(\"span\",{className:styles.maxButton,onClick:function onClick(){return setAmount(balance);},children:\"MAX\"}):null]}),/*#__PURE__*/_jsx(TokenButton,{mint:mint,onClick:function onClick(){return setShowTokenDialog(true);}})]})]});}function TokenButton(_ref5){var mint=_ref5.mint,onClick=_ref5.onClick;var styles=useStyles();var theme=useTheme();return/*#__PURE__*/_jsxs(\"div\",{onClick:onClick,className:styles.tokenButton,children:[/*#__PURE__*/_jsx(TokenIcon,{mint:mint,style:{height:theme.spacing(3),paddingLeft:theme.spacing(1)}}),/*#__PURE__*/_jsx(TokenName,{mint:mint,style:{fontSize:14,fontWeight:700}})]});}export function TokenIcon(_ref6){var mint=_ref6.mint,style=_ref6.style;var tokenMap=useTokenMap();var tokenInfo=tokenMap.get(mint.toString());return/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",justifyContent:\"center\",flexDirection:\"column\",padding:\"5px 5px\"},children:(tokenInfo===null||tokenInfo===void 0?void 0:tokenInfo.logoURI)?/*#__PURE__*/_jsx(\"img\",{alt:\"Logo\",style:style,src:tokenInfo===null||tokenInfo===void 0?void 0:tokenInfo.logoURI}):/*#__PURE__*/_jsx(\"div\",{style:style})});}function TokenName(_ref7){var mint=_ref7.mint,style=_ref7.style;var tokenMap=useTokenMap();var theme=useTheme();var tokenInfo=tokenMap.get(mint.toString());return/*#__PURE__*/_jsx(Typography,{style:_objectSpread({marginLeft:theme.spacing(2),marginRight:theme.spacing(1)},style),children:tokenInfo===null||tokenInfo===void 0?void 0:tokenInfo.symbol});}export function SwapButton(){var styles=useStyles();var _useSwapContext4=useSwapContext(),fromMint=_useSwapContext4.fromMint,toMint=_useSwapContext4.toMint,fromAmount=_useSwapContext4.fromAmount,slippage=_useSwapContext4.slippage,isClosingNewAccounts=_useSwapContext4.isClosingNewAccounts,isStrict=_useSwapContext4.isStrict;var _useDexContext=useDexContext(),swapClient=_useDexContext.swapClient;var fromMintInfo=useMint(fromMint);var toMintInfo=useMint(toMint);var openOrders=useOpenOrders();var route=useRouteVerbose(fromMint,toMint);var fromMarket=useMarket(route&&route.markets?route.markets[0]:undefined);var toMarket=useMarket(route&&route.markets?route.markets[1]:undefined);var canSwap=useCanSwap();var referral=useReferral(fromMarket);var fair=useSwapFair();var fromWallet=useOwnedTokenAccount(fromMint);var toWallet=useOwnedTokenAccount(toMint);var quoteMint=fromMarket&&fromMarket.quoteMintAddress;var quoteMintInfo=useMint(quoteMint);var quoteWallet=useOwnedTokenAccount(quoteMint);// Click handler.\nvar sendSwapTransaction=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var amount,isSol,wrappedSolAccount,txs,_txs$0$signers,_txs$0$signers2,_yield$wrapSol,wrapTx,wrapSigners,_unwrapSol,unwrapTx,unwrapSigners,tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!fromMintInfo||!toMintInfo)){_context2.next=2;break;}throw new Error(\"Unable to calculate mint decimals\");case 2:if(fair){_context2.next=4;break;}throw new Error(\"Invalid fair\");case 4:if(!(!quoteMint||!quoteMintInfo)){_context2.next=6;break;}throw new Error(\"Quote mint not found\");case 6:amount=new BN(fromAmount*Math.pow(10,fromMintInfo.decimals));isSol=fromMint.equals(SOL_MINT)||toMint.equals(SOL_MINT);wrappedSolAccount=isSol?Keypair.generate():undefined;// Build the swap.\n_context2.next=11;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var minExchangeRate,fromOpenOrders,toOpenOrders,fromWalletAddr,toWalletAddr;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(fromMarket){_context.next=2;break;}throw new Error(\"Market undefined\");case 2:minExchangeRate={rate:new BN(Math.pow(10,toMintInfo.decimals)*FEE_MULTIPLIER/fair).muln(100-slippage).divn(100),fromDecimals:fromMintInfo.decimals,quoteDecimals:quoteMintInfo.decimals,strict:isStrict};fromOpenOrders=fromMarket?openOrders.get(fromMarket===null||fromMarket===void 0?void 0:fromMarket.address.toString()):undefined;toOpenOrders=toMarket?openOrders.get(toMarket===null||toMarket===void 0?void 0:toMarket.address.toString()):undefined;fromWalletAddr=fromMint.equals(SOL_MINT)?wrappedSolAccount.publicKey:fromWallet?fromWallet.publicKey:undefined;toWalletAddr=toMint.equals(SOL_MINT)?wrappedSolAccount.publicKey:toWallet?toWallet.publicKey:undefined;_context.next=9;return swapClient.swapTxs({fromMint:fromMint,toMint:toMint,quoteMint:quoteMint,amount:amount,minExchangeRate:minExchangeRate,referral:referral,fromMarket:fromMarket,toMarket:toMarket,// Automatically created if undefined.\nfromOpenOrders:fromOpenOrders?fromOpenOrders[0].address:undefined,toOpenOrders:toOpenOrders?toOpenOrders[0].address:undefined,fromWallet:fromWalletAddr,toWallet:toWalletAddr,quoteWallet:quoteWallet?quoteWallet.publicKey:undefined,// Auto close newly created open orders accounts.\nclose:isClosingNewAccounts});case 9:return _context.abrupt(\"return\",_context.sent);case 10:case\"end\":return _context.stop();}}},_callee);}))();case 11:txs=_context2.sent;if(!isSol){_context2.next=28;break;}if(!(txs.length>1)){_context2.next=15;break;}throw new Error(\"SOL must be swapped in a single transaction\");case 15:_context2.next=17;return wrapSol(swapClient.program.provider,wrappedSolAccount,fromMint,amount);case 17:_yield$wrapSol=_context2.sent;wrapTx=_yield$wrapSol.tx;wrapSigners=_yield$wrapSol.signers;_unwrapSol=unwrapSol(swapClient.program.provider,wrappedSolAccount),unwrapTx=_unwrapSol.tx,unwrapSigners=_unwrapSol.signers;tx=new Transaction();tx.add(wrapTx);tx.add(txs[0].tx);tx.add(unwrapTx);txs[0].tx=tx;(_txs$0$signers=txs[0].signers).push.apply(_txs$0$signers,_toConsumableArray(wrapSigners));(_txs$0$signers2=txs[0].signers).push.apply(_txs$0$signers2,_toConsumableArray(unwrapSigners));case 28:_context2.next=30;return swapClient.program.provider.sendAll(txs);case 30:case\"end\":return _context2.stop();}}},_callee2);}));return function sendSwapTransaction(){return _ref8.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:styles.swapButton,onClick:sendSwapTransaction// disabled={!canSwap}\n,children:canSwap?\"Swap\":\"Connect Wallet\"});}function wrapSol(_x,_x2,_x3,_x4){return _wrapSol.apply(this,arguments);}function _wrapSol(){_wrapSol=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(provider,wrappedSolAccount,fromMint,amount){var tx,signers;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:tx=new Transaction();signers=[wrappedSolAccount];// Create new, rent exempt account.\n_context3.t0=tx;_context3.t1=SystemProgram;_context3.t2=provider.wallet.publicKey;_context3.t3=wrappedSolAccount.publicKey;_context3.next=8;return Token.getMinBalanceRentForExemptAccount(provider.connection);case 8:_context3.t4=_context3.sent;_context3.t5=TOKEN_PROGRAM_ID;_context3.t6={fromPubkey:_context3.t2,newAccountPubkey:_context3.t3,lamports:_context3.t4,space:165,programId:_context3.t5};_context3.t7=_context3.t1.createAccount.call(_context3.t1,_context3.t6);_context3.t0.add.call(_context3.t0,_context3.t7);// Transfer lamports. These will be converted to an SPL balance by the\n// token program.\nif(fromMint.equals(SOL_MINT)){tx.add(SystemProgram.transfer({fromPubkey:provider.wallet.publicKey,toPubkey:wrappedSolAccount.publicKey,lamports:amount.toNumber()}));}// Initialize the account.\ntx.add(Token.createInitAccountInstruction(TOKEN_PROGRAM_ID,WRAPPED_SOL_MINT,wrappedSolAccount.publicKey,provider.wallet.publicKey));return _context3.abrupt(\"return\",{tx:tx,signers:signers});case 16:case\"end\":return _context3.stop();}}},_callee3);}));return _wrapSol.apply(this,arguments);}function unwrapSol(provider,wrappedSolAccount){var tx=new Transaction();tx.add(Token.createCloseAccountInstruction(TOKEN_PROGRAM_ID,wrappedSolAccount.publicKey,provider.wallet.publicKey,provider.wallet.publicKey,[]));return{tx:tx,signers:[]};}","map":{"version":3,"sources":["/Users/selasie/Documents/GitHub/dex_ui/swap-ui/src/components/Swap.tsx"],"names":["useState","Keypair","Transaction","SystemProgram","Token","TOKEN_PROGRAM_ID","BN","makeStyles","Card","Button","Typography","TextField","useTheme","ImportExportRounded","useSwapContext","useSwapFair","useDexContext","useOpenOrders","useRouteVerbose","useMarket","FEE_MULTIPLIER","useTokenMap","useMint","useOwnedTokenAccount","useCanSwap","useReferral","TokenDialog","SettingsButton","InfoLabel","SOL_MINT","WRAPPED_SOL_MINT","useStyles","theme","card","width","spacing","borderRadius","background","border","color","boxShadow","padding","tab","settingsButton","swapButton","textTransform","backgroundColor","fontSize","fontWeight","swapToFromButton","display","margin","cursor","amountInput","input","textAlign","swapTokenFormContainer","justifyContent","swapTokenSelectorContainer","marginLeft","flexDirection","balanceContainer","alignItems","maxButton","palette","primary","main","tokenButton","marginBottom","SwapCard","containerStyle","contentStyle","swapTokenContainerStyle","styles","SwapHeader","ArrowButton","swapToFromMints","SwapFromForm","style","fromMint","setFromMint","fromAmount","setFromAmount","SwapToForm","toMint","setToMint","toAmount","setToAmount","SwapTokenForm","from","mint","setMint","amount","setAmount","showTokenDialog","setShowTokenDialog","tokenAccount","mintAccount","balance","account","toNumber","decimals","formattedAmount","toLocaleString","maximumFractionDigits","useGrouping","e","parseFloat","target","value","disableUnderline","classes","root","toFixed","TokenButton","onClick","height","paddingLeft","TokenIcon","tokenMap","tokenInfo","get","toString","logoURI","TokenName","marginRight","symbol","SwapButton","slippage","isClosingNewAccounts","isStrict","swapClient","fromMintInfo","toMintInfo","openOrders","route","fromMarket","markets","undefined","toMarket","canSwap","referral","fair","fromWallet","toWallet","quoteMint","quoteMintAddress","quoteMintInfo","quoteWallet","sendSwapTransaction","Error","isSol","equals","wrappedSolAccount","generate","minExchangeRate","rate","muln","divn","fromDecimals","quoteDecimals","strict","fromOpenOrders","address","toOpenOrders","fromWalletAddr","publicKey","toWalletAddr","swapTxs","close","txs","length","wrapSol","program","provider","wrapTx","tx","wrapSigners","signers","unwrapSol","unwrapTx","unwrapSigners","add","push","sendAll","wallet","getMinBalanceRentForExemptAccount","connection","fromPubkey","newAccountPubkey","lamports","space","programId","createAccount","transfer","toPubkey","createInitAccountInstruction","createCloseAccountInstruction"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport {\n  PublicKey,\n  Keypair,\n  Transaction,\n  SystemProgram,\n  Signer,\n} from \"@solana/web3.js\";\nimport { Token, TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\nimport { BN, Provider } from \"@project-serum/anchor\";\nimport {\n  makeStyles,\n  Card,\n  Button,\n  Typography,\n  TextField,\n  useTheme,\n} from \"@material-ui/core\";\nimport { ExpandMore, ImportExportRounded } from \"@material-ui/icons\";\nimport { useSwapContext, useSwapFair } from \"../context/Swap\";\nimport {\n  useDexContext,\n  useOpenOrders,\n  useRouteVerbose,\n  useMarket,\n  FEE_MULTIPLIER,\n} from \"../context/Dex\";\nimport { useTokenMap } from \"../context/TokenList\";\nimport { useMint, useOwnedTokenAccount } from \"../context/Token\";\nimport { useCanSwap, useReferral } from \"../context/Swap\";\nimport TokenDialog from \"./TokenDialog\";\nimport { SettingsButton } from \"./Settings\";\nimport { InfoLabel } from \"./Info\";\nimport { SOL_MINT, WRAPPED_SOL_MINT } from \"../utils/pubkeys\";\n\nconst useStyles = makeStyles((theme) => ({\n  card: {\n    width: theme.spacing(50),\n    borderRadius: theme.spacing(2),\n    background: \"#22242a\",\n    border: \"1px solid #aaaaaa36\",\n    color: \"white !important\",\n    boxShadow: \"0px 0px 30px 5px rgba(0,0,0,0.075)\",\n    padding: theme.spacing(2),\n  },\n  tab: {\n    width: \"50%\",\n  },\n  settingsButton: {\n    padding: 0,\n  },\n  swapButton: {\n    width: \"100%\",\n    textTransform: \"capitalize\",\n    borderRadius: theme.spacing(2),\n    backgroundColor: \"#323741\",\n    color: \"white !important\",\n    fontSize: 16,\n    fontWeight: 700,\n    padding: theme.spacing(1.5),\n  },\n  swapToFromButton: {\n    display: \"block\",\n    margin: \"5px auto 5px auto\",\n    cursor: \"pointer\",\n  },\n  amountInput: {\n    fontSize: 22,\n    fontWeight: 600,\n    color: \"white !important\"\n  },\n  input: {\n    textAlign: \"left\",\n    color: \"white !important\"\n  },\n  swapTokenFormContainer: {\n    borderRadius: theme.spacing(2),\n    boxShadow: \"0px 0px 15px 2px rgba(33,150,243,0.1)\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    background: \"#323741\",\n    padding: \"5px 10px 5px 15px\",\n    border: \"1px solid #ffffff1c\"\n  },\n  swapTokenSelectorContainer: {\n    marginLeft: theme.spacing(1),\n    display: \"flex\",\n    justifyContent: \"flex-end\",\n    flexDirection: \"column\",\n    width: \"30%\",\n  },\n  balanceContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: \"2px 0px\",\n    fontSize: \"12px\",\n    color: \"#bebebe\"\n  },\n  maxButton: {\n    marginLeft: theme.spacing(1),\n    color: theme.palette.primary.main,\n    fontWeight: 700,\n    fontSize: \"12px\",\n    cursor: \"pointer\",\n  },\n  tokenButton: {\n    display: \"flex\",\n    alignItems: \"center\",\n    cursor: \"pointer\",\n    marginBottom: theme.spacing(1),\n    border: \"1px solid #585858\",\n    borderRadius: \"20px\",\n    background: \"#161616\"\n  },\n}));\n\nexport default function SwapCard({\n  containerStyle,\n  contentStyle,\n  swapTokenContainerStyle,\n}: {\n  containerStyle?: any;\n  contentStyle?: any;\n  swapTokenContainerStyle?: any;\n}) {\n  const styles = useStyles();\n  return (\n    <Card className={styles.card} style={containerStyle}>\n      {/* <SwapHeader /> */}\n      <div style={contentStyle}>\n        <SwapFromForm style={swapTokenContainerStyle} />\n        <ArrowButton />\n        <SwapToForm style={swapTokenContainerStyle} />\n        <InfoLabel />\n        <SwapButton />\n      </div>\n    </Card>\n  );\n}\n\nexport function SwapHeader() {\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        marginBottom: \"16px\",\n      }}\n    >\n      <SettingsButton />\n    </div>\n  );\n}\n\nexport function ArrowButton() {\n  const styles = useStyles();\n  const theme = useTheme();\n  const { swapToFromMints } = useSwapContext();\n  return (\n    <ImportExportRounded\n      className={styles.swapToFromButton}\n      fontSize=\"medium\"\n      htmlColor={theme.palette.primary.main}\n      onClick={swapToFromMints}\n    />\n  );\n}\n\nfunction SwapFromForm({ style }: { style?: any }) {\n  const { fromMint, setFromMint, fromAmount, setFromAmount } = useSwapContext();\n  return (\n    <SwapTokenForm\n      from\n      style={style}\n      mint={fromMint}\n      setMint={setFromMint}\n      amount={fromAmount}\n      setAmount={setFromAmount}\n    />\n  );\n}\n\nfunction SwapToForm({ style }: { style?: any }) {\n  const { toMint, setToMint, toAmount, setToAmount } = useSwapContext();\n  return (\n    <SwapTokenForm\n      from={false}\n      style={style}\n      mint={toMint}\n      setMint={setToMint}\n      amount={toAmount}\n      setAmount={setToAmount}\n    />\n  );\n}\n\nexport function SwapTokenForm({\n  from,\n  style,\n  mint,\n  setMint,\n  amount,\n  setAmount,\n}: {\n  from: boolean;\n  style?: any;\n  mint: PublicKey;\n  setMint: (m: PublicKey) => void;\n  amount: number;\n  setAmount: (a: number) => void;\n}) {\n  const styles = useStyles();\n\n  const [showTokenDialog, setShowTokenDialog] = useState(false);\n  const tokenAccount = useOwnedTokenAccount(mint);\n  const mintAccount = useMint(mint);\n\n  const balance =\n    tokenAccount &&\n    mintAccount &&\n    tokenAccount.account.amount.toNumber() / 10 ** mintAccount.decimals;\n\n  const formattedAmount =\n    mintAccount && amount\n      ? amount.toLocaleString(\"fullwide\", {\n          maximumFractionDigits: mintAccount.decimals,\n          useGrouping: false,\n        })\n      : amount;\n\n  return (\n    <div className={styles.swapTokenFormContainer} style={style}>\n      \n      <TokenDialog\n        setMint={setMint}\n        open={showTokenDialog}\n        onClose={() => setShowTokenDialog(false)}\n      />\n      <div>\n        <Typography className={styles.balanceContainer}>\n        {from\n            ? `From`\n            : `To`\n        }\n        </Typography>\n        <TextField\n          type=\"number\"\n          value={formattedAmount}\n          onChange={(e) => setAmount(parseFloat(e.target.value))}\n          InputProps={{\n            disableUnderline: true,\n            classes: {\n              root: styles.amountInput,\n              input: styles.input,\n            },\n          }}\n        />\n      </div>\n      <div className={styles.swapTokenSelectorContainer}>\n        <Typography className={styles.balanceContainer}>\n          {tokenAccount && mintAccount\n            ? `Balance: ${balance?.toFixed(mintAccount.decimals)}`\n            : `Balance : 0.00`}\n          {from && !!balance ? (\n            <span\n              className={styles.maxButton}\n              onClick={() => setAmount(balance)}\n            >\n              MAX\n            </span>\n          ) : null}\n        </Typography>\n        <TokenButton mint={mint} onClick={() => setShowTokenDialog(true)} />\n      </div>\n    </div>\n  );\n}\n\nfunction TokenButton({\n  mint,\n  onClick,\n}: {\n  mint: PublicKey;\n  onClick: () => void;\n}) {\n  const styles = useStyles();\n  const theme = useTheme();\n\n  return (\n    <div onClick={onClick} className={styles.tokenButton}>\n      <TokenIcon mint={mint} style={{ height: theme.spacing(3), paddingLeft: theme.spacing(1) }} />\n      <TokenName mint={mint} style={{ fontSize: 14, fontWeight: 700 }} />\n      {/* <ExpandMore /> */}\n    </div>\n  );\n}\n\nexport function TokenIcon({ mint, style }: { mint: PublicKey; style: any }) {\n  const tokenMap = useTokenMap();\n  let tokenInfo = tokenMap.get(mint.toString());\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        flexDirection: \"column\",\n        padding: \"5px 5px\"\n      }}\n    >\n      {tokenInfo?.logoURI ? (\n        <img alt=\"Logo\" style={style} src={tokenInfo?.logoURI} />\n      ) : (\n        <div style={style}></div>\n      )}\n    </div>\n  );\n}\n\nfunction TokenName({ mint, style }: { mint: PublicKey; style: any }) {\n  const tokenMap = useTokenMap();\n  const theme = useTheme();\n  let tokenInfo = tokenMap.get(mint.toString());\n\n  return (\n    <Typography\n      style={{\n        marginLeft: theme.spacing(2),\n        marginRight: theme.spacing(1),\n        ...style,\n      }}\n    >\n      {tokenInfo?.symbol}\n    </Typography>\n  );\n}\n\nexport function SwapButton() {\n  const styles = useStyles();\n  const {\n    fromMint,\n    toMint,\n    fromAmount,\n    slippage,\n    isClosingNewAccounts,\n    isStrict,\n  } = useSwapContext();\n  const { swapClient } = useDexContext();\n  const fromMintInfo = useMint(fromMint);\n  const toMintInfo = useMint(toMint);\n  const openOrders = useOpenOrders();\n  const route = useRouteVerbose(fromMint, toMint);\n  const fromMarket = useMarket(\n    route && route.markets ? route.markets[0] : undefined\n  );\n  const toMarket = useMarket(\n    route && route.markets ? route.markets[1] : undefined\n  );\n  const canSwap = useCanSwap();\n  const referral = useReferral(fromMarket);\n  const fair = useSwapFair();\n  let fromWallet = useOwnedTokenAccount(fromMint);\n  let toWallet = useOwnedTokenAccount(toMint);\n  const quoteMint = fromMarket && fromMarket.quoteMintAddress;\n  const quoteMintInfo = useMint(quoteMint);\n  const quoteWallet = useOwnedTokenAccount(quoteMint);\n\n  // Click handler.\n  const sendSwapTransaction = async () => {\n    if (!fromMintInfo || !toMintInfo) {\n      throw new Error(\"Unable to calculate mint decimals\");\n    }\n    if (!fair) {\n      throw new Error(\"Invalid fair\");\n    }\n    if (!quoteMint || !quoteMintInfo) {\n      throw new Error(\"Quote mint not found\");\n    }\n\n    const amount = new BN(fromAmount * 10 ** fromMintInfo.decimals);\n    const isSol = fromMint.equals(SOL_MINT) || toMint.equals(SOL_MINT);\n    const wrappedSolAccount = isSol ? Keypair.generate() : undefined;\n\n    // Build the swap.\n    let txs = await (async () => {\n      if (!fromMarket) {\n        throw new Error(\"Market undefined\");\n      }\n\n      const minExchangeRate = {\n        rate: new BN((10 ** toMintInfo.decimals * FEE_MULTIPLIER) / fair)\n          .muln(100 - slippage)\n          .divn(100),\n        fromDecimals: fromMintInfo.decimals,\n        quoteDecimals: quoteMintInfo.decimals,\n        strict: isStrict,\n      };\n      const fromOpenOrders = fromMarket\n        ? openOrders.get(fromMarket?.address.toString())\n        : undefined;\n      const toOpenOrders = toMarket\n        ? openOrders.get(toMarket?.address.toString())\n        : undefined;\n      const fromWalletAddr = fromMint.equals(SOL_MINT)\n        ? wrappedSolAccount!.publicKey\n        : fromWallet\n        ? fromWallet.publicKey\n        : undefined;\n      const toWalletAddr = toMint.equals(SOL_MINT)\n        ? wrappedSolAccount!.publicKey\n        : toWallet\n        ? toWallet.publicKey\n        : undefined;\n\n      return await swapClient.swapTxs({\n        fromMint,\n        toMint,\n        quoteMint,\n        amount,\n        minExchangeRate,\n        referral,\n        fromMarket,\n        toMarket,\n        // Automatically created if undefined.\n        fromOpenOrders: fromOpenOrders ? fromOpenOrders[0].address : undefined,\n        toOpenOrders: toOpenOrders ? toOpenOrders[0].address : undefined,\n        fromWallet: fromWalletAddr,\n        toWallet: toWalletAddr,\n        quoteWallet: quoteWallet ? quoteWallet.publicKey : undefined,\n        // Auto close newly created open orders accounts.\n        close: isClosingNewAccounts,\n      });\n    })();\n\n    // If swapping SOL, then insert a wrap/unwrap instruction.\n    if (isSol) {\n      if (txs.length > 1) {\n        throw new Error(\"SOL must be swapped in a single transaction\");\n      }\n      const { tx: wrapTx, signers: wrapSigners } = await wrapSol(\n        swapClient.program.provider,\n        wrappedSolAccount as Keypair,\n        fromMint,\n        amount\n      );\n      const { tx: unwrapTx, signers: unwrapSigners } = unwrapSol(\n        swapClient.program.provider,\n        wrappedSolAccount as Keypair\n      );\n      const tx = new Transaction();\n      tx.add(wrapTx);\n      tx.add(txs[0].tx);\n      tx.add(unwrapTx);\n      txs[0].tx = tx;\n      txs[0].signers.push(...wrapSigners);\n      txs[0].signers.push(...unwrapSigners);\n    }\n\n    await swapClient.program.provider.sendAll(txs);\n  };\n  return (\n    <Button\n      variant=\"contained\"\n      className={styles.swapButton}\n      onClick={sendSwapTransaction}\n      // disabled={!canSwap}\n    >\n      {canSwap\n            ? `Swap`\n            : `Connect Wallet`}\n      \n    </Button>\n  );\n}\n\nasync function wrapSol(\n  provider: Provider,\n  wrappedSolAccount: Keypair,\n  fromMint: PublicKey,\n  amount: BN\n): Promise<{ tx: Transaction; signers: Array<Signer | undefined> }> {\n  const tx = new Transaction();\n  const signers = [wrappedSolAccount];\n  // Create new, rent exempt account.\n  tx.add(\n    SystemProgram.createAccount({\n      fromPubkey: provider.wallet.publicKey,\n      newAccountPubkey: wrappedSolAccount.publicKey,\n      lamports: await Token.getMinBalanceRentForExemptAccount(\n        provider.connection\n      ),\n      space: 165,\n      programId: TOKEN_PROGRAM_ID,\n    })\n  );\n  // Transfer lamports. These will be converted to an SPL balance by the\n  // token program.\n  if (fromMint.equals(SOL_MINT)) {\n    tx.add(\n      SystemProgram.transfer({\n        fromPubkey: provider.wallet.publicKey,\n        toPubkey: wrappedSolAccount.publicKey,\n        lamports: amount.toNumber(),\n      })\n    );\n  }\n  // Initialize the account.\n  tx.add(\n    Token.createInitAccountInstruction(\n      TOKEN_PROGRAM_ID,\n      WRAPPED_SOL_MINT,\n      wrappedSolAccount.publicKey,\n      provider.wallet.publicKey\n    )\n  );\n  return { tx, signers };\n}\n\nfunction unwrapSol(\n  provider: Provider,\n  wrappedSolAccount: Keypair\n): { tx: Transaction; signers: Array<Signer | undefined> } {\n  const tx = new Transaction();\n  tx.add(\n    Token.createCloseAccountInstruction(\n      TOKEN_PROGRAM_ID,\n      wrappedSolAccount.publicKey,\n      provider.wallet.publicKey,\n      provider.wallet.publicKey,\n      []\n    )\n  );\n  return { tx, signers: [] };\n}\n"]},"metadata":{},"sourceType":"module"}