{"ast":null,"code":"import _regeneratorRuntime from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/selasie/Documents/GitHub/dex_ui/swap-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useMemo,useEffect}from\"react\";import{PublicKey}from\"@solana/web3.js\";import{makeStyles,Dialog,DialogContent,Paper,Table,TableRow,TableHead,TableCell,TableBody,TableContainer,IconButton,Typography,Button,Select,MenuItem,Link}from\"@material-ui/core\";import{Close}from\"@material-ui/icons\";import{useMarket,useOpenOrders,useDexContext}from\"../context/Dex\";import{useTokenMap}from\"../context/TokenList\";import{useMint,useOwnedTokenAccount}from\"../context/Token\";import{DEX_PID}from\"../utils/pubkeys\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{table:{},closeAccount:{color:theme.palette.error.main}};});export default function OpenOrdersDialog(_ref){var open=_ref.open,onClose=_ref.onClose;return/*#__PURE__*/_jsxs(Dialog,{maxWidth:\"lg\",open:open,onClose:onClose,PaperProps:{style:{borderRadius:\"10px\"}},children:[/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",justifyContent:\"flex-end\"},children:/*#__PURE__*/_jsx(IconButton,{onClick:onClose,style:{padding:10},children:/*#__PURE__*/_jsx(Close,{})})}),/*#__PURE__*/_jsx(DialogContent,{style:{paddingTop:0},children:/*#__PURE__*/_jsx(OpenOrdersAccounts,{})})]});}function OpenOrdersAccounts(){var styles=useStyles();var openOrders=useOpenOrders();var openOrdersEntries=useMemo(function(){return Array.from(openOrders.entries()).map(function(_ref2){var _ref3=_slicedToArray(_ref2,2),market=_ref3[0],oo=_ref3[1];return[new PublicKey(market),oo];});},[openOrders]);return/*#__PURE__*/_jsx(TableContainer,{component:Paper,elevation:0,children:/*#__PURE__*/_jsxs(Table,{className:styles.table,\"aria-label\":\"simple table\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Market\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Open Orders Account\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Base Used\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Base Free\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Quote Used\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Quote Free\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Settle\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Close\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:openOrdersEntries.map(function(_ref4){var _ref5=_slicedToArray(_ref4,2),market=_ref5[0],oos=_ref5[1];return/*#__PURE__*/_jsx(OpenOrdersRow,{market:market,openOrders:oos},market.toString());})})]})});}function OpenOrdersRow(_ref6){var _tokenMap$get,_tokenMap$get2;var market=_ref6.market,openOrders=_ref6.openOrders;var styles=useStyles();var _useState=useState(openOrders[0]),_useState2=_slicedToArray(_useState,2),ooAccount=_useState2[0],setOoAccount=_useState2[1];useEffect(function(){setOoAccount(openOrders[0]);},[openOrders]);var _useDexContext=useDexContext(),swapClient=_useDexContext.swapClient,closeOpenOrders=_useDexContext.closeOpenOrders;var marketClient=useMarket(market);var tokenMap=useTokenMap();var base=useMint(marketClient===null||marketClient===void 0?void 0:marketClient.baseMintAddress);var quote=useMint(marketClient===null||marketClient===void 0?void 0:marketClient.quoteMintAddress);var baseWallet=useOwnedTokenAccount(marketClient===null||marketClient===void 0?void 0:marketClient.baseMintAddress);var quoteWallet=useOwnedTokenAccount(marketClient===null||marketClient===void 0?void 0:marketClient.quoteMintAddress);var baseTicker=marketClient?(_tokenMap$get=tokenMap.get(marketClient===null||marketClient===void 0?void 0:marketClient.baseMintAddress.toString()))===null||_tokenMap$get===void 0?void 0:_tokenMap$get.symbol:\"-\";var quoteTicker=marketClient?(_tokenMap$get2=tokenMap.get(marketClient===null||marketClient===void 0?void 0:marketClient.quoteMintAddress.toString()))===null||_tokenMap$get2===void 0?void 0:_tokenMap$get2.symbol:\"-\";var marketName=baseTicker&&quoteTicker?\"\".concat(baseTicker,\" / \").concat(quoteTicker):market.toString();var settleDisabled=ooAccount.baseTokenFree.toNumber()+ooAccount.quoteTokenFree.toNumber()===0;var closeDisabled=ooAccount.baseTokenTotal.toNumber()+ooAccount.quoteTokenTotal.toNumber()!==0;var settleFunds=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var referrerWallet,_yield$marketClient$m,transaction,signers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(marketClient){_context.next=2;break;}throw new Error(\"Market client not found\");case 2:if(!(!baseWallet||!quoteWallet)){_context.next=4;break;}throw new Error(\"Base or quote wallet not found\");case 4:referrerWallet=undefined;_context.next=7;return marketClient.makeSettleFundsTransaction(swapClient.program.provider.connection,ooAccount,baseWallet.publicKey,quoteWallet.publicKey,referrerWallet);case 7:_yield$marketClient$m=_context.sent;transaction=_yield$marketClient$m.transaction;signers=_yield$marketClient$m.signers;_context.next=12;return swapClient.program.provider.send(transaction,signers);case 12:case\"end\":return _context.stop();}}},_callee);}));return function settleFunds(){return _ref7.apply(this,arguments);};}();var _closeOpenOrders=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return swapClient.program.rpc.closeAccount({accounts:{openOrders:ooAccount.address,authority:swapClient.program.provider.wallet.publicKey,destination:swapClient.program.provider.wallet.publicKey,market:marketClient.address,dexProgram:DEX_PID}});case 2:closeOpenOrders(ooAccount);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function _closeOpenOrders(){return _ref8.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",scope:\"row\",children:/*#__PURE__*/_jsx(Typography,{children:/*#__PURE__*/_jsx(Link,{href:\"https://dex.projectserum.com/#/market/\".concat(market.toString()),target:\"_blank\",rel:\"noopener\",children:marketName})})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Select,{value:ooAccount.address.toString(),onChange:function onChange(e){return setOoAccount(openOrders.filter(function(oo){return oo.address.toString()===e.target.value;})[0]);},children:openOrders.map(function(oo){return/*#__PURE__*/_jsx(MenuItem,{value:oo.address.toString(),children:oo.address.toString()},oo.address.toString());})})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:toDisplay(base,ooAccount.baseTokenTotal.sub(ooAccount.baseTokenFree))}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:toDisplay(base,ooAccount.baseTokenFree)}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:toDisplay(quote,ooAccount.quoteTokenTotal.sub(ooAccount.quoteTokenFree))}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:toDisplay(quote,ooAccount.quoteTokenFree)}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Button,{color:\"primary\",disabled:settleDisabled,onClick:settleFunds,children:\"Settle\"})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Button,{disabled:closeDisabled,onClick:_closeOpenOrders,className:styles.closeAccount,children:\"Close\"})})]},market.toString());}function toDisplay(mintInfo,value){if(!mintInfo){return value.toNumber().toString();}return(value.toNumber()/Math.pow(10,mintInfo.decimals)).toFixed(mintInfo.decimals);}","map":{"version":3,"sources":["/Users/selasie/Documents/GitHub/dex_ui/swap-ui/src/components/OpenOrdersDialog.tsx"],"names":["useState","useMemo","useEffect","PublicKey","makeStyles","Dialog","DialogContent","Paper","Table","TableRow","TableHead","TableCell","TableBody","TableContainer","IconButton","Typography","Button","Select","MenuItem","Link","Close","useMarket","useOpenOrders","useDexContext","useTokenMap","useMint","useOwnedTokenAccount","DEX_PID","useStyles","theme","table","closeAccount","color","palette","error","main","OpenOrdersDialog","open","onClose","style","borderRadius","display","justifyContent","padding","paddingTop","OpenOrdersAccounts","styles","openOrders","openOrdersEntries","Array","from","entries","map","market","oo","oos","toString","OpenOrdersRow","ooAccount","setOoAccount","swapClient","closeOpenOrders","marketClient","tokenMap","base","baseMintAddress","quote","quoteMintAddress","baseWallet","quoteWallet","baseTicker","get","symbol","quoteTicker","marketName","settleDisabled","baseTokenFree","toNumber","quoteTokenFree","closeDisabled","baseTokenTotal","quoteTokenTotal","settleFunds","Error","referrerWallet","undefined","makeSettleFundsTransaction","program","provider","connection","publicKey","transaction","signers","send","_closeOpenOrders","rpc","accounts","address","authority","wallet","destination","dexProgram","e","filter","target","value","toDisplay","sub","mintInfo","decimals","toFixed"],"mappings":"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","sourcesContent":["import { useState, useMemo, useEffect } from \"react\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport { MintInfo } from \"@solana/spl-token\";\nimport { BN } from \"@project-serum/anchor\";\nimport { OpenOrders } from \"@project-serum/serum\";\nimport {\n  makeStyles,\n  Dialog,\n  DialogContent,\n  Paper,\n  Table,\n  TableRow,\n  TableHead,\n  TableCell,\n  TableBody,\n  TableContainer,\n  IconButton,\n  Typography,\n  Button,\n  Select,\n  MenuItem,\n  Link,\n} from \"@material-ui/core\";\nimport { Close } from \"@material-ui/icons\";\nimport { useMarket, useOpenOrders, useDexContext } from \"../context/Dex\";\nimport { useTokenMap } from \"../context/TokenList\";\nimport { useMint, useOwnedTokenAccount } from \"../context/Token\";\nimport { DEX_PID } from \"../utils/pubkeys\";\n\nconst useStyles = makeStyles((theme) => ({\n  table: {},\n  closeAccount: {\n    color: theme.palette.error.main,\n  },\n}));\n\nexport default function OpenOrdersDialog({\n  open,\n  onClose,\n}: {\n  open: boolean;\n  onClose: () => void;\n}) {\n  return (\n    <Dialog\n      maxWidth=\"lg\"\n      open={open}\n      onClose={onClose}\n      PaperProps={{\n        style: {\n          borderRadius: \"10px\",\n        },\n      }}\n    >\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <IconButton\n          onClick={onClose}\n          style={{\n            padding: 10,\n          }}\n        >\n          <Close />\n        </IconButton>\n      </div>\n      <DialogContent style={{ paddingTop: 0 }}>\n        <OpenOrdersAccounts />\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction OpenOrdersAccounts() {\n  const styles = useStyles();\n  const openOrders = useOpenOrders();\n  const openOrdersEntries: Array<[PublicKey, OpenOrders[]]> = useMemo(() => {\n    return Array.from(openOrders.entries()).map(([market, oo]) => [\n      new PublicKey(market),\n      oo,\n    ]);\n  }, [openOrders]);\n  return (\n    <TableContainer component={Paper} elevation={0}>\n      <Table className={styles.table} aria-label=\"simple table\">\n        <TableHead>\n          <TableRow>\n            <TableCell>Market</TableCell>\n            <TableCell align=\"center\">Open Orders Account</TableCell>\n            <TableCell align=\"center\">Base Used</TableCell>\n            <TableCell align=\"center\">Base Free</TableCell>\n            <TableCell align=\"center\">Quote Used</TableCell>\n            <TableCell align=\"center\">Quote Free</TableCell>\n            <TableCell align=\"center\">Settle</TableCell>\n            <TableCell align=\"center\">Close</TableCell>\n          </TableRow>\n        </TableHead>\n        <TableBody>\n          {openOrdersEntries.map(([market, oos]) => {\n            return (\n              <OpenOrdersRow\n                key={market.toString()}\n                market={market}\n                openOrders={oos}\n              />\n            );\n          })}\n        </TableBody>\n      </Table>\n    </TableContainer>\n  );\n}\n\nfunction OpenOrdersRow({\n  market,\n  openOrders,\n}: {\n  market: PublicKey;\n  openOrders: Array<OpenOrders>;\n}) {\n  const styles = useStyles();\n  const [ooAccount, setOoAccount] = useState(openOrders[0]);\n  useEffect(() => {\n    setOoAccount(openOrders[0]);\n  }, [openOrders]);\n  const { swapClient, closeOpenOrders } = useDexContext();\n  const marketClient = useMarket(market);\n  const tokenMap = useTokenMap();\n  const base = useMint(marketClient?.baseMintAddress);\n  const quote = useMint(marketClient?.quoteMintAddress);\n  const baseWallet = useOwnedTokenAccount(marketClient?.baseMintAddress);\n  const quoteWallet = useOwnedTokenAccount(marketClient?.quoteMintAddress);\n  const baseTicker = marketClient\n    ? tokenMap.get(marketClient?.baseMintAddress.toString())?.symbol\n    : \"-\";\n  const quoteTicker = marketClient\n    ? tokenMap.get(marketClient?.quoteMintAddress.toString())?.symbol\n    : \"-\";\n  const marketName =\n    baseTicker && quoteTicker\n      ? `${baseTicker} / ${quoteTicker}`\n      : market.toString();\n  const settleDisabled =\n    ooAccount.baseTokenFree.toNumber() + ooAccount.quoteTokenFree.toNumber() ===\n    0;\n  const closeDisabled =\n    ooAccount.baseTokenTotal.toNumber() +\n      ooAccount.quoteTokenTotal.toNumber() !==\n    0;\n\n  const settleFunds = async () => {\n    if (!marketClient) {\n      throw new Error(\"Market client not found\");\n    }\n    if (!baseWallet || !quoteWallet) {\n      throw new Error(\"Base or quote wallet not found\");\n    }\n    const referrerWallet = undefined;\n    const { transaction, signers } =\n      await marketClient.makeSettleFundsTransaction(\n        swapClient.program.provider.connection,\n        ooAccount,\n        baseWallet.publicKey,\n        quoteWallet.publicKey,\n        referrerWallet\n      );\n    await swapClient.program.provider.send(transaction, signers);\n  };\n\n  const _closeOpenOrders = async () => {\n    await swapClient.program.rpc.closeAccount({\n      accounts: {\n        openOrders: ooAccount.address,\n        authority: swapClient.program.provider.wallet.publicKey,\n        destination: swapClient.program.provider.wallet.publicKey,\n        market: marketClient!.address,\n        dexProgram: DEX_PID,\n      },\n    });\n    closeOpenOrders(ooAccount);\n  };\n\n  return (\n    <TableRow key={market.toString()}>\n      <TableCell component=\"th\" scope=\"row\">\n        <Typography>\n          <Link\n            href={`https://dex.projectserum.com/#/market/${market.toString()}`}\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            {marketName}\n          </Link>\n        </Typography>\n      </TableCell>\n      <TableCell align=\"center\">\n        <Select\n          value={ooAccount.address.toString()}\n          onChange={(e) =>\n            setOoAccount(\n              openOrders.filter(\n                (oo) => oo.address.toString() === e.target.value\n              )[0]\n            )\n          }\n        >\n          {openOrders.map((oo) => {\n            return (\n              <MenuItem\n                key={oo.address.toString()}\n                value={oo.address.toString()}\n              >\n                {oo.address.toString()}\n              </MenuItem>\n            );\n          })}\n        </Select>\n      </TableCell>\n      <TableCell align=\"center\">\n        {toDisplay(base, ooAccount.baseTokenTotal.sub(ooAccount.baseTokenFree))}\n      </TableCell>\n      <TableCell align=\"center\">\n        {toDisplay(base, ooAccount.baseTokenFree)}\n      </TableCell>\n      <TableCell align=\"center\">\n        {toDisplay(\n          quote,\n          ooAccount.quoteTokenTotal.sub(ooAccount.quoteTokenFree)\n        )}\n      </TableCell>\n      <TableCell align=\"center\">\n        {toDisplay(quote, ooAccount.quoteTokenFree)}\n      </TableCell>\n      <TableCell align=\"center\">\n        <Button color=\"primary\" disabled={settleDisabled} onClick={settleFunds}>\n          Settle\n        </Button>\n      </TableCell>\n      <TableCell align=\"center\">\n        <Button\n          disabled={closeDisabled}\n          onClick={_closeOpenOrders}\n          className={styles.closeAccount}\n        >\n          Close\n        </Button>\n      </TableCell>\n    </TableRow>\n  );\n}\n\nfunction toDisplay(mintInfo: MintInfo | undefined | null, value: BN): string {\n  if (!mintInfo) {\n    return value.toNumber().toString();\n  }\n  return (value.toNumber() / 10 ** mintInfo.decimals).toFixed(\n    mintInfo.decimals\n  );\n}\n"]},"metadata":{},"sourceType":"module"}